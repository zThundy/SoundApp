name: Test App Launch

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  test-windows-launch:
    runs-on: windows-latest
    
    if: contains(github.event.head_commit.message, '[test]')

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build application
        run: npm run build

      - name: Test application launch
        run: |
          echo "Testing application startup..."
          $process = Start-Process -FilePath "npm" -ArgumentList "run", "dev" -PassThru -NoNewWindow
          Start-Sleep -Seconds 10
          
          if ($process.HasExited) {
            echo "Application failed to start"
            exit 1
          } else {
            echo "Application started successfully"
            Stop-Process -Id $process.Id -Force
            exit 0
          }
        shell: pwsh
        timeout-minutes: 5

      - name: Check for errors in logs
        if: failure()
        run: |
          echo "Application launch failed. Check logs above for details."
