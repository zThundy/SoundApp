<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Twitch Chat Overlay</title>

  <!-- Custom style from frontend -->
</head>

<body>
  <!-- Custom html from frontend -->

  <script>
    const es = new EventSource('/events');
    const messagesContainer = document.getElementById('messages');
    const MAX_MESSAGES = 50;

    es.onmessage = (ev) => {
      try {
        const data = JSON.parse(ev.data);
        console.log('Received chat data:', data);
        
        if (data.type === "twitch-chat") {
          addMessage(data.username, data.message, data.color);
          if (onChatMessage) onChatMessage(data);
        }
      } catch (e) {
        console.error('Bad payload', e, ev.data);
      }
    };

    function addMessage(username, message, color = '#FFFFFF') {
      const messageEl = document.createElement('div');
      messageEl.className = 'message';
      
      const usernameEl = document.createElement('span');
      usernameEl.className = 'username';
      usernameEl.textContent = username + ':';
      usernameEl.style.color = color;
      
      const textEl = document.createElement('span');
      textEl.className = 'message-text';
      textEl.textContent = message;
      
      messageEl.appendChild(usernameEl);
      messageEl.appendChild(textEl);
      messagesContainer.appendChild(messageEl);
      
      // Scroll to bottom
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      // Remove old messages if we exceed max
      while (messagesContainer.children.length > MAX_MESSAGES) {
        messagesContainer.removeChild(messagesContainer.firstChild);
      }
    }

    es.onerror = (err) => {
      console.error('EventSource error:', err);
    };
  </script>

  <!-- Custom js from frontend -->
</body>

</html>